<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets 中的文字</title>
    <style>
        /* 添加整個屏幕的邊框 */
        html, body {
            height: 100%;
            border: 5px solid #ccc;
            margin: 0;
            padding: 0;
        }
        /* 隱藏捲軸 */
        body {
            overflow: hidden;
        }
        /* 添加移動動畫效果 */
        #sheet-content {
            position: relative;
        }
        #sheet-content span {
            position: absolute;
            font-weight: bold;
            transition: transform 0.5s;
        }
        /* 放置圖片到左下角 */
        #cup-img {
            position: absolute;
            left: 20px;
            bottom: 20px;
            width: 100px;
            height: auto;
        }
        /* 美化按鈕 */
        button {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body style="background-color: #f0f0f0;">

<h1>Google Sheets 中的文字</h1>

<div id="sheet-content">
    <!-- Google Sheets 中的文字將會填充到這裡 -->
</div>

<img id="cup-img" src="cup.png" alt="cup">

<button id="move-text-btn" onclick="moveTextToCup()">將所有文字放入cup</button>

<script>
var animationIntervalId;

function getRandomColor(usedColors) {
    var color;
    do {
        color = '#' + Math.floor(Math.random()*16777215).toString(16); // 生成隨機顏色
    } while (usedColors.includes(color)); // 確保顏色不重複
    return color;
}

function updateSheetContent() {
    // 使用 Google Sheets 共享連結的方式載入資料
    var sheetURL = "https://docs.google.com/spreadsheets/d/16TV6m6KVKWevEOkRGg9PPCcDOXCJx1MoaDOtVIOAYcg/edit?usp=sharing";

    // 從 Google Sheets 載入資料
    fetch(sheetURL)
        .then(response => response.text())
        .then(data => {
            // 解析 HTML 字符串，尋找表格內容
            var parser = new DOMParser();
            var htmlDoc = parser.parseFromString(data, 'text/html');
            var tableRows = htmlDoc.querySelectorAll('.waffle tr');
            var tableContent = "";
            var usedColors = []; // 存儲已使用的顏色

            // 循環處理表格行
            tableRows.forEach(row => {
                var rowData = "";
                var tableCells = row.querySelectorAll('td');

                // 循環處理表格單元格
                tableCells.forEach(cell => {
                    // 生成隨機顏色
                    var randomColor = getRandomColor(usedColors);
                    usedColors.push(randomColor); // 添加新生成的顏色到已使用的顏色列表
                    var randomSize = Math.floor(Math.random() * 6) + 18; // 字體大小範圍為 18 到 24
                    var randomX = Math.random() * (window.innerWidth - 200); // 隨機 X 軸位置
                    randomX = Math.max(randomX, 0); // 限制在屏幕內
                    randomX = Math.min(randomX, window.innerWidth - 200); // 限制在屏幕內
                    var randomY = Math.random() * (window.innerHeight - 50); // 隨機 Y 軸位置
                    randomY = Math.max(randomY, 0); // 限制在屏幕內
                    randomY = Math.min(randomY, window.innerHeight - 50); // 限制在屏幕內
                    rowData += '<span style="color: ' + randomColor + '; font-size: ' + randomSize + 'px; left: ' + randomX + 'px; top: ' + randomY + 'px;">' + cell.textContent + '</span> ';
                });

                // 將每行的內容添加到表格內容中
                tableContent += "<p>" + rowData.trim() + '</p>';
            });

            // 將表格內容填充到指定的元素中
            document.getElementById('sheet-content').innerHTML = tableContent;
        })
        .catch(error => console.error('Error:', error));
}

// 每 5 秒更新一次 Google Sheets 中的資料
setInterval(updateSheetContent, 5000);

// 初始化時立即更新一次
updateSheetContent();

function moveTextToCup() {
    var spans = document.querySelectorAll('#sheet-content span');
    spans.forEach(span => {
        var cupX = document.getElementById('cup-img').offsetLeft;
        var cupY = document.getElementById('cup-img').offsetTop;
        span.style.transform = `translate(${cupX}px, ${cupY}px)`;
    });

    var btn = document.getElementById('move-text-btn');
    if (btn.innerHTML === '將所有文字放入cup') {
        btn.innerHTML = '釋放文字';
    } else {
        btn.innerHTML = '將所有文字放入cup';
    }
}

// 碰到邊框就反彈
document.addEventListener('DOMContentLoaded', function() {
    var spans = document.querySelectorAll('#sheet-content span');
    var maxX = window.innerWidth - 200;
    var maxY = window.innerHeight - 50;
    spans.forEach(span => {
        var moveX = Math.random() > 0.5 ? 1 : -1; // 隨機選擇移動方向
        var moveY = Math.random() > 0.5 ? 1 : -1; // 隨機選擇移動方向
        var speedX = Math.random() * 2 + 1; // 隨機速度
        var speedY = Math.random() * 2 + 1; // 隨機速度
        setInterval(function() {
            var rect = span.getBoundingClientRect();
            var x = rect.left + moveX * speedX;
            var y = rect.top + moveY * speedY;
            if (x < 0 || x > maxX) {
                moveX *= -1;
            }
            if (y < 0 || y > maxY) {
                moveY *= -1;
            }
            span.style.left = x + 'px';
            span.style.top = y + 'px';
        }, 50);
    });
});
</script>

</body>
</html>
